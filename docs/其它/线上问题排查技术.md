# 线上问题排查技术

## Cpu占用过高

先查出哪个线程占用Cpu资源，再使用`jstack`查看正在运行的线程，将线程编号换算成16进制找到对应线程排查

```powershell
# 检测后台进程对Cpu和内存的占用情况
top
# 输出所有进程线程的CPU占用百分比
ps H -eo pid, tid, %cpu | grep [进程号]
# 输出详细信息
jstack [进程号]
```

## 排查死锁

使用`jstack`输出详细信息，最后会有`Found one java-level deadlock`，表示有死锁产生，还会给你标注哪两个线程产生了死锁。

## 执行GC之后内存占用依然很高

使用jvisualvm打开GUI面板，监视 -> 堆 Dump，截取一个内存快照。

检查 -> 查找前20个最大的对象，可以检查到哪几个对象占用了大量的内存。

