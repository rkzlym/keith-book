# 高并发系统设计

## 性能瓶颈

关于性能的几个要点：IO，缓存，限流，资源隔离服务降级

### IO

1. 使用多线程异步的方式来处理请求

### 缓存

1. 客户端/浏览器缓存：localStorage，sessionStorage
2. 流量接入层缓存：HttpDNS、Waf、全网CDN
3. 应用接入层缓存：Nginx静态文件缓存、Nginx动态文件缓存（Openresty + Lua）网关
4. 应用缓存层：redis
5. 应用业务层：JVM缓存，MQ
6. 数据持久层：Mysql

## 限流

> 在使用缓存和降级都无效的场景，如当达到阈值后限制接口调用频率，访问次数等，在出现服务不可用之前，提前把服务降级，只服务好一部分用户。

计数器算法：比如线程池大小，数据库连接池大小、nginx连接数等都属于计数器算法

漏斗算法

令牌桶算法

并发限流

接口限流

### 资源隔离服务降级

> 某个服务出现故障时，可以隔离故障，阻止传播，防止雪崩

线程隔离：主要是在多线程环境下，对线程池进行治理，把核心业务和非核心业务分割开

进程隔离：cpu、内存这些资源可以通过不同的虚拟机进程来做隔离，如集群

集群隔离：如秒杀等计算IO高的服务需要独立拆分模块

机房隔离异地多活：将服务器整体建立副本在多机房做冷备份，使用DNS，HttpDNS，负载均衡等技术快速切换

读写分离：mysql，redis等数据存储服务集群化

动静分离：将静态资源从原有服务中隔离出来





