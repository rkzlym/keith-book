# 分布式

## 相关术语

**qps**：每秒的并发请求数 （Nginx：5w qps，Tomcat：200 qps）

**集群**：镜像

**分布式**：服务模块化拆分

**SOA**：面向服务架构

**SOA协议**

- WebService（XML）：TCP -> Http -> SOAP 
- Dubbo（二进制）：TCP -> Dubbo协议
- SpringCloud（HTTP）：TCP -> Http协议

**网络传输格式**

- XML：文件大，性能低，结构严谨，可使用XSD校验

- JSON：文件小，性能高，结构不严谨，可读性差

- 序列化：最小（二进制数据），性能最高，面向对象，无可读性

## CAP

1. Consistency 一致性

   分布式系统中，数据在多节点存在副本，当数据发生了修改，那么数据同步无法在修改的<font color=red>瞬间</font>广播到所有副本节点，那么在读的时候就可能发生数据脏读

2. Availbility 可用性

   指的是服务是否可用，范围涵盖终端客户访问我们的系统或者是集群内部相互通讯交换数据

   也就是说在 Client 向 Server 发起请求时，服务器返回了正确的响应，称之为可用，反之为不可用

   1S法则：是面向Web侧，H5链路上加载性能和体验方向上的一个指标

   - 4G/WIFI下，1秒完全完成页面加载，包括首屏资源，可看亦可用;
   - 3G下1秒完成首包的返回 ;
   - 2G下1秒完成建连。

3. Partition Torlerance 分区容错性

   分布式网络中部分网络不可用，但系统依然正常对外提供服务。

CP：不同空间中的数据，如果要求他们所有状态一致，则必然不在同一时间。

AP：不同空间中，如果要求同一时间都可以从任意的空间拿到数据，则必然数据的状态不一致。

CA：不同空间的数据，如果要求任意时间都可以从任意空间拿到状态一致的数据，则空间数必然为1.

zookeepr：**CP**，即任何时刻对zookeeper的访问请求能得到一致性的数据结果，同时系统对网络分割具备容错性，但是它不能保证每次服务的可用性。从实际情况来分析，在使用zookeeper获取服务列表时，如果zk正在选举或者zk集群中半数以上的机器不可用，那么将无法获取数据。所以说，zk不能保证服务可用性。

eureka：**AP**，eureka在设计时优先保证可用性，每一个节点都是平等的，一部分节点挂掉不会影响到正常节点的工作，不会出现类似zk的选举leader的过程，客户端发现向某个节点注册或连接失败，会自动切换到其他的节点，只要有一台eureka存在，就可以保证整个服务处在可用状态，只不过有可能这个服务上的信息并不是最新的信息。
