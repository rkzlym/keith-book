(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{389:function(a,s,t){"use strict";t.r(s);var n=t(42),r=Object(n.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"lua"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lua"}},[a._v("#")]),a._v(" Lua")]),a._v(" "),t("h2",{attrs:{id:"lua-程序设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lua-程序设计"}},[a._v("#")]),a._v(" Lua 程序设计")]),a._v(" "),t("p",[a._v("Lua 是由巴西里约热内卢天主教大学（Pontifical Catholic University of Rio de Janeiro）里的一个研究小组于1993年开发的一种轻量、小巧的脚本语言，用标准 C 语言编写，其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。")]),a._v(" "),t("p",[a._v("官网：http://www.lua.org/")]),a._v(" "),t("p",[a._v("Redis 在 2.6 版本中推出了脚本功能，允许开发者将 Lua 语言编写的脚本传到 Redis 中执行。使用 Lua 脚本的优点有如下几点:")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("减少网络开销：本来需要多次请求的操作，可以一次请求完成，从而节约网络开销；")])]),a._v(" "),t("li",[t("p",[a._v("原子操作：Redis 会将整个脚本作为一个整体执行，中间不会执行其它命令；")])]),a._v(" "),t("li",[t("p",[a._v("复用：客户端发送的脚本会存储在 Redis 中，从而实现脚本的复用。")])])]),a._v(" "),t("h2",{attrs:{id:"lua-基本语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lua-基本语法"}},[a._v("#")]),a._v(" Lua 基本语法")]),a._v(" "),t("h3",{attrs:{id:"注释"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注释"}},[a._v("#")]),a._v(" 注释")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 两个减号是行注释")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("--[[\n\n 这是块注释\n\n --]]")]),a._v("\n")])])]),t("h3",{attrs:{id:"变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#变量"}},[a._v("#")]),a._v(" 变量")]),a._v(" "),t("h4",{attrs:{id:"数字类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数字类型"}},[a._v("#")]),a._v(" 数字类型")]),a._v(" "),t("p",[a._v("Lua的数字只有double型，64bits")]),a._v(" "),t("p",[a._v("你可以以如下的方式表示数字")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("num "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),a._v("\n\nnum "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.0")]),a._v("\n\nnum "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.1416")]),a._v("\n\nnum "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("314.16e-2")]),a._v("\n\nnum "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.31416E1")]),a._v("\n\nnum "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0xff")]),a._v("\n\nnum "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0x56")]),a._v("\n")])])]),t("h4",{attrs:{id:"字符串"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字符串"}},[a._v("#")]),a._v(" 字符串")]),a._v(" "),t("p",[a._v("可以用单引号，也可以用双引号")]),a._v(" "),t("p",[a._v("也可以使用转义字符‘\\n’ （换行）， ‘\\r’ （回车）， ‘\\t’ （横向制表）， ‘\\v’ （纵向制表）， ‘\\’ （反斜杠）， ‘\\”‘ （双引号）， 以及 ‘\\” （单引号)等等")]),a._v(" "),t("p",[a._v("下面的四种方式定义了完全相同的字符串（其中的两个中括号可以用于定义有换行的字符串）")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('a = \'alo\\n123"\'\n\na = "alo\\n123\\""\n\na = \'\\97lo\\10\\04923"\'\n\na = [[alo\n\n123"]]\n')])])]),t("h4",{attrs:{id:"空值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#空值"}},[a._v("#")]),a._v(" 空值")]),a._v(" "),t("p",[a._v("C语言中的NULL在Lua中是nil，比如你访问一个没有声明过的变量，就是nil")]),a._v(" "),t("h4",{attrs:{id:"布尔类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#布尔类型"}},[a._v("#")]),a._v(" 布尔类型")]),a._v(" "),t("p",[a._v("只有nil和false是 false")]),a._v(" "),t("p",[a._v("数字0，‘’空字符串（’\\0’）都是true")]),a._v(" "),t("h4",{attrs:{id:"作用域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#作用域"}},[a._v("#")]),a._v(" 作用域")]),a._v(" "),t("p",[a._v("lua中的变量如果没有特殊说明，全是全局变量，那怕是语句块或是函数里。")]),a._v(" "),t("p",[a._v("变量前加local关键字的是局部变量。")]),a._v(" "),t("h3",{attrs:{id:"控制语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#控制语句"}},[a._v("#")]),a._v(" 控制语句")]),a._v(" "),t("h4",{attrs:{id:"while循环"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#while循环"}},[a._v("#")]),a._v(" while循环")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("while")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\ni "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n")])])]),t("h4",{attrs:{id:"if-else"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#if-else"}},[a._v("#")]),a._v(" if-else")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" age "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("140")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" sex "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Male'")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" age "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("40")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("and")]),a._v(" sex "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Male"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('" 男人四十一枝花 "')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("elseif")]),a._v(" age "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("and")]),a._v(" sex "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("~=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Female"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"old man without country!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("elseif")]),a._v(" age "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"too young, too naive!\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Your age is "')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("..")]),a._v("age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 调用")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h4",{attrs:{id:"for循环"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#for循环"}},[a._v("#")]),a._v(" for循环")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("sum "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\n    sum "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" sum "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" i\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("sum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h4",{attrs:{id:"函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#函数"}},[a._v("#")]),a._v(" 函数")]),a._v(" "),t("p",[a._v("普通函数")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("myPower")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" y"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v("x\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\npower2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("myPower")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("power2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("p",[a._v("匿名函数")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("newCounter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- anonymous function")]),a._v("\n        i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" i\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\nc1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("newCounter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("c1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("--\x3e 1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("c1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("--\x3e 2")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("c1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h4",{attrs:{id:"返回值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#返回值"}},[a._v("#")]),a._v(" 返回值")]),a._v(" "),t("p",[a._v("多返回值")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" bGay "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"yiming"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("37")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"yimingl@hotmail.com"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("bGay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("p",[a._v("函数返回值")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("isMyGirl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'xiao6'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" name\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" bol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("isMyGirl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'xiao6'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("bol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h3",{attrs:{id:"集合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集合"}},[a._v("#")]),a._v(" 集合")]),a._v(" "),t("h4",{attrs:{id:"table"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#table"}},[a._v("#")]),a._v(" Table")]),a._v(" "),t("p",[a._v("key，value的键值对 类似 map")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("lucy "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'xiao6'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("age"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("height"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("165.5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\nxiao6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("age"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("35")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("xiao6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("xiao6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("xiao6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("height"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("xiao6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h4",{attrs:{id:"数组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数组"}},[a._v("#")]),a._v(" 数组")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("arr "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"string"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"xiao6"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"memeda"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("arr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h4",{attrs:{id:"数组遍历"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数组遍历"}},[a._v("#")]),a._v(" 数组遍历")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" v "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("pairs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("arr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n")])])]),t("h4",{attrs:{id:"面向对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#面向对象"}},[a._v("#")]),a._v(" 面向对象")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("person "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'xiao6'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("age "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v("  person"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("eat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("food"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("person"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("..")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('" eating "')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("..")]),a._v("food"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\nperson"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("eat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"xxoo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h2",{attrs:{id:"lua-整合-redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lua-整合-redis"}},[a._v("#")]),a._v(" Lua 整合 redis")]),a._v(" "),t("h3",{attrs:{id:"在redis中执行简单脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在redis中执行简单脚本"}},[a._v("#")]),a._v(" 在redis中执行简单脚本")]),a._v(" "),t("p",[a._v("登录到客户端后执行")]),a._v(" "),t("h4",{attrs:{id:"hello-world"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hello-world"}},[a._v("#")]),a._v(" Hello world")]),a._v(" "),t("div",{staticClass:"language-properties extra-class"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#命令    脚本        \t参数个数")]),a._v('\neval\t"return 1+1"    0\n')])])]),t("h4",{attrs:{id:"参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[a._v("#")]),a._v(" 参数")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("EVAL "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("\"local msg='hello world' return msg..KEYS[1]\"")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" AAA BBB\n")])])]),t("p",[a._v("表是基于1的，也就是说索引以数值1开始。所以在表中的第一个元素就是mytable[1]，第二个就是mytable[2]等等。 表中不能有nil值。如果一个操作表中有[1, nil, 3, 4]，那么结果将会是[1]——表将会在第一个nil截断。")]),a._v(" "),t("h3",{attrs:{id:"独立脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#独立脚本"}},[a._v("#")]),a._v(" 独立脚本")]),a._v(" "),t("h4",{attrs:{id:"获取key的value"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取key的value"}},[a._v("#")]),a._v(" 获取key的value")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" key"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("KEYS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" list"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("call")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("  \n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h4",{attrs:{id:"读取redis集合中的数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#读取redis集合中的数据"}},[a._v("#")]),a._v(" 读取redis集合中的数据")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" key"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("KEYS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" list"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("call")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"lrange"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h4",{attrs:{id:"统计点击次数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#统计点击次数"}},[a._v("#")]),a._v(" 统计点击次数")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" msg"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'count:'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("local")]),a._v(" count "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("call")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"count"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("not")]),a._v(" count "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n        redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("call")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"set"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"count"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("end")]),a._v("\n\nredis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("call")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"incr"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"count"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" msg"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("..")]),a._v("count"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])])]),t("h4",{attrs:{id:"执行lua脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行lua脚本"}},[a._v("#")]),a._v(" 执行lua脚本")]),a._v(" "),t("h5",{attrs:{id:"本地执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地执行"}},[a._v("#")]),a._v(" 本地执行")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("redis-cli --eval test.lua aaa,bbb\n")])])]),t("h5",{attrs:{id:"远程执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#远程执行"}},[a._v("#")]),a._v(" 远程执行")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("cli "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("h "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".2")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".161")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("a密码 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("--eval /usr/local/luascript/test.lua name age , xiao6")]),a._v("\n")])])]),t("h3",{attrs:{id:"lua-与-redis-交互"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lua-与-redis-交互"}},[a._v("#")]),a._v(" Lua 与 Redis 交互")]),a._v(" "),t("h4",{attrs:{id:"lua-脚本获取-eval-evalsha-命令的参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lua-脚本获取-eval-evalsha-命令的参数"}},[a._v("#")]),a._v(" Lua 脚本获取 EVAL & EVALSHA 命令的参数")]),a._v(" "),t("p",[a._v("通过 Lua 脚本的全局变量 KEYS 和 ARGV，能够访问 EVAL 和 EVALSHA 命令的 key [key ...] 参数和 arg [arg ...] 参数。")]),a._v(" "),t("p",[a._v("作为 Lua Table，能够将 KEYS 和 ARGV 作为一维数组使用，其下标从 1 开始。")]),a._v(" "),t("h4",{attrs:{id:"lua-脚本内部执行-redis-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lua-脚本内部执行-redis-命令"}},[a._v("#")]),a._v(" Lua 脚本内部执行 Redis 命令")]),a._v(" "),t("p",[a._v("Lua 脚本内部允许通过内置函数执行 Redis 命令：")]),a._v(" "),t("p",[a._v("redis.call()")]),a._v(" "),t("p",[a._v("redis.pcall()")]),a._v(" "),t("p",[a._v("两者非常相似，区别在于：")]),a._v(" "),t("p",[a._v("若 Redis 命令执行错误，redis.call() 将错误抛出（即 EVAL & EVALSHA 执行出错）；")]),a._v(" "),t("p",[a._v("redis.pcall() 将错误内容返回。")]),a._v(" "),t("p",[a._v('local msg=\'count:\'  local count = redis.call("get","count")  if not count then          redis.call("set","count",1)  end  redis.call("incr","count")  return msg..count+1')]),a._v(" "),t("h3",{attrs:{id:"redis-watch-multi-exec-与lua"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-watch-multi-exec-与lua"}},[a._v("#")]),a._v(" redis WATCH/MULTI/EXEC 与Lua")]),a._v(" "),t("p",[a._v("redis 原生支持 监听、事务、批处理，那么还需要lua吗？")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("两者不存在竞争关系，而是增强关系，lua可以完成redis自身没有的功能")])]),a._v(" "),t("li",[t("p",[a._v("在lua中可以使用上一步的结果，也就是可以开发"),t("strong",[a._v("后面操作依赖前面操作的执行结果的应用")]),a._v("，MULT中的命令都是独立操作")])]),a._v(" "),t("li",[t("p",[a._v("redis可以编写模块增强功能，但是c语言写模块，太难了，lua简单的多")])]),a._v(" "),t("li",[t("p",[a._v("计算向数据移动")])]),a._v(" "),t("li",[t("p",[a._v("原子操作")])])]),a._v(" "),t("p",[a._v("lua脚本尽量短小并且尽量保证同一事物写在一段脚本内，因为redis是单线程的，过长的执行会造成阻塞，影响服务器性能。")]),a._v(" "),t("h3",{attrs:{id:"redis-lua-脚本管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-lua-脚本管理"}},[a._v("#")]),a._v(" Redis Lua 脚本管理")]),a._v(" "),t("p",[a._v("1.script load  此命令用于将Lua脚本加载到Redis内存中")]),a._v(" "),t("p",[a._v("2.script exists  scripts exists sha1 [sha1 …]  此命令用于判断sha1是否已经加载到Redis内存中")]),a._v(" "),t("p",[a._v("3.script flush  此命令用于清除Redis内存已经加载的所有Lua脚本,在执行script flush后,sha1不复存在")]),a._v(" "),t("p",[a._v("4.script kill  此命令用于杀掉正在执行的Lua脚本")]),a._v(" "),t("h3",{attrs:{id:"死锁"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#死锁"}},[a._v("#")]),a._v(" 死锁")]),a._v(" "),t("p",[a._v("下面代码会进入死循环，导致redis无法接受其他命令。")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("eval "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"while true do end"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" \n")])])]),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6379")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" keys "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" BUSY Redis is busy running a script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v(" You can only call SCRIPT KILL "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("or")]),a._v(" SHUTDOWN NOSAVE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n")])])]),t("p",[a._v("但是可以接受 SCRIPT KILL or SHUTDOWN NOSAVE. 两个命令")]),a._v(" "),t("p",[a._v("SHUTDOWN NOSAVE 不会进行持久化的操作")]),a._v(" "),t("p",[a._v("SCRIPT KILL 可以杀死正在执行的进程")]),a._v(" "),t("h3",{attrs:{id:"生产环境下部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生产环境下部署"}},[a._v("#")]),a._v(" 生产环境下部署")]),a._v(" "),t("h4",{attrs:{id:"加载到redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加载到redis"}},[a._v("#")]),a._v(" 加载到redis")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("cli script load "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"$(cat test.lua)"')]),a._v("\n")])])]),t("p",[a._v("得到sha1值")]),a._v(" "),t("p",[a._v("执行")]),a._v(" "),t("div",{staticClass:"language-lua extra-class"},[t("pre",{pre:!0,attrs:{class:"language-lua"}},[t("code",[a._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("cli evalsha "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"7a2054836e94e19da22c13f160bd987fbc9ef146"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);