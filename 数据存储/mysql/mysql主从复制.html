<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql 主从复制 | 鸿鹄笔记</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" content="/favicon.ico">
    <meta name="description" content="鸿鹄的个人笔记">
    <meta rel="author" content="Keith">
    
    <link rel="preload" href="/keith-book/assets/css/0.styles.86c07c9d.css" as="style"><link rel="preload" href="/keith-book/assets/js/app.7ae60ab7.js" as="script"><link rel="preload" href="/keith-book/assets/js/2.044773f5.js" as="script"><link rel="preload" href="/keith-book/assets/js/49.a0d6928f.js" as="script"><link rel="prefetch" href="/keith-book/assets/js/10.13f771ae.js"><link rel="prefetch" href="/keith-book/assets/js/100.af11b532.js"><link rel="prefetch" href="/keith-book/assets/js/101.b5e393e3.js"><link rel="prefetch" href="/keith-book/assets/js/102.7a7d2386.js"><link rel="prefetch" href="/keith-book/assets/js/103.4b5c8925.js"><link rel="prefetch" href="/keith-book/assets/js/104.8c63d13c.js"><link rel="prefetch" href="/keith-book/assets/js/105.2bfbf884.js"><link rel="prefetch" href="/keith-book/assets/js/106.47faa20d.js"><link rel="prefetch" href="/keith-book/assets/js/107.9ad2a314.js"><link rel="prefetch" href="/keith-book/assets/js/108.008b5fa7.js"><link rel="prefetch" href="/keith-book/assets/js/109.62761423.js"><link rel="prefetch" href="/keith-book/assets/js/11.a6a3b5c9.js"><link rel="prefetch" href="/keith-book/assets/js/110.8afb8e61.js"><link rel="prefetch" href="/keith-book/assets/js/111.57012fed.js"><link rel="prefetch" href="/keith-book/assets/js/112.535b424f.js"><link rel="prefetch" href="/keith-book/assets/js/113.c23530b0.js"><link rel="prefetch" href="/keith-book/assets/js/114.834b12cd.js"><link rel="prefetch" href="/keith-book/assets/js/115.ce1b3169.js"><link rel="prefetch" href="/keith-book/assets/js/116.65b1520c.js"><link rel="prefetch" href="/keith-book/assets/js/117.fd80cfe9.js"><link rel="prefetch" href="/keith-book/assets/js/118.f05a98aa.js"><link rel="prefetch" href="/keith-book/assets/js/119.4cea8196.js"><link rel="prefetch" href="/keith-book/assets/js/12.42246af7.js"><link rel="prefetch" href="/keith-book/assets/js/120.275abc51.js"><link rel="prefetch" href="/keith-book/assets/js/121.0a4ec53d.js"><link rel="prefetch" href="/keith-book/assets/js/122.aebc3a0f.js"><link rel="prefetch" href="/keith-book/assets/js/123.a9c61bf2.js"><link rel="prefetch" href="/keith-book/assets/js/124.54f656c9.js"><link rel="prefetch" href="/keith-book/assets/js/125.554faf7e.js"><link rel="prefetch" href="/keith-book/assets/js/126.88f70416.js"><link rel="prefetch" href="/keith-book/assets/js/127.7aeb22c3.js"><link rel="prefetch" href="/keith-book/assets/js/128.5e8f8a6c.js"><link rel="prefetch" href="/keith-book/assets/js/129.d96c386d.js"><link rel="prefetch" href="/keith-book/assets/js/13.614d862e.js"><link rel="prefetch" href="/keith-book/assets/js/14.d938dc50.js"><link rel="prefetch" href="/keith-book/assets/js/15.27956206.js"><link rel="prefetch" href="/keith-book/assets/js/16.8259d213.js"><link rel="prefetch" href="/keith-book/assets/js/17.59fccf41.js"><link rel="prefetch" href="/keith-book/assets/js/18.1ae9a1fd.js"><link rel="prefetch" href="/keith-book/assets/js/19.3f56180c.js"><link rel="prefetch" href="/keith-book/assets/js/20.a6a8e2d9.js"><link rel="prefetch" href="/keith-book/assets/js/21.fa3c5532.js"><link rel="prefetch" href="/keith-book/assets/js/22.8c3384e6.js"><link rel="prefetch" href="/keith-book/assets/js/23.8ea8dbc6.js"><link rel="prefetch" href="/keith-book/assets/js/24.d65bce25.js"><link rel="prefetch" href="/keith-book/assets/js/25.b2d0686f.js"><link rel="prefetch" href="/keith-book/assets/js/26.fdc5f5b5.js"><link rel="prefetch" href="/keith-book/assets/js/27.8bb47b1d.js"><link rel="prefetch" href="/keith-book/assets/js/28.e087e2b0.js"><link rel="prefetch" href="/keith-book/assets/js/29.4306565c.js"><link rel="prefetch" href="/keith-book/assets/js/3.83866d44.js"><link rel="prefetch" href="/keith-book/assets/js/30.92b9c15a.js"><link rel="prefetch" href="/keith-book/assets/js/31.a231c5d0.js"><link rel="prefetch" href="/keith-book/assets/js/32.30b3c540.js"><link rel="prefetch" href="/keith-book/assets/js/33.d4ae83e5.js"><link rel="prefetch" href="/keith-book/assets/js/34.2d831459.js"><link rel="prefetch" href="/keith-book/assets/js/35.fd638673.js"><link rel="prefetch" href="/keith-book/assets/js/36.a936bf23.js"><link rel="prefetch" href="/keith-book/assets/js/37.f0a03b08.js"><link rel="prefetch" href="/keith-book/assets/js/38.635b6ac3.js"><link rel="prefetch" href="/keith-book/assets/js/39.dc3d7a09.js"><link rel="prefetch" href="/keith-book/assets/js/4.e2dc8d0c.js"><link rel="prefetch" href="/keith-book/assets/js/40.06264354.js"><link rel="prefetch" href="/keith-book/assets/js/41.a5492cc2.js"><link rel="prefetch" href="/keith-book/assets/js/42.be57bef1.js"><link rel="prefetch" href="/keith-book/assets/js/43.88a27c79.js"><link rel="prefetch" href="/keith-book/assets/js/44.c4499e0a.js"><link rel="prefetch" href="/keith-book/assets/js/45.bc3d4bb0.js"><link rel="prefetch" href="/keith-book/assets/js/46.77fe74ff.js"><link rel="prefetch" href="/keith-book/assets/js/47.a6d9e6fb.js"><link rel="prefetch" href="/keith-book/assets/js/48.aef4698e.js"><link rel="prefetch" href="/keith-book/assets/js/5.281837e2.js"><link rel="prefetch" href="/keith-book/assets/js/50.97367378.js"><link rel="prefetch" href="/keith-book/assets/js/51.5aa97e63.js"><link rel="prefetch" href="/keith-book/assets/js/52.c8645f8c.js"><link rel="prefetch" href="/keith-book/assets/js/53.ddb048d3.js"><link rel="prefetch" href="/keith-book/assets/js/54.4b3240ad.js"><link rel="prefetch" href="/keith-book/assets/js/55.906f19b3.js"><link rel="prefetch" href="/keith-book/assets/js/56.ab84e214.js"><link rel="prefetch" href="/keith-book/assets/js/57.4b0773ba.js"><link rel="prefetch" href="/keith-book/assets/js/58.ba67fb3c.js"><link rel="prefetch" href="/keith-book/assets/js/59.c70cec7d.js"><link rel="prefetch" href="/keith-book/assets/js/6.a3b769ae.js"><link rel="prefetch" href="/keith-book/assets/js/60.328ff957.js"><link rel="prefetch" href="/keith-book/assets/js/61.821c95c9.js"><link rel="prefetch" href="/keith-book/assets/js/62.a8706fa5.js"><link rel="prefetch" href="/keith-book/assets/js/63.7893739a.js"><link rel="prefetch" href="/keith-book/assets/js/64.e0e82da5.js"><link rel="prefetch" href="/keith-book/assets/js/65.c8630545.js"><link rel="prefetch" href="/keith-book/assets/js/66.71acb88b.js"><link rel="prefetch" href="/keith-book/assets/js/67.1d69d8ae.js"><link rel="prefetch" href="/keith-book/assets/js/68.cbcd16b5.js"><link rel="prefetch" href="/keith-book/assets/js/69.7ad720f1.js"><link rel="prefetch" href="/keith-book/assets/js/7.4d8a2bf7.js"><link rel="prefetch" href="/keith-book/assets/js/70.94b0ffc1.js"><link rel="prefetch" href="/keith-book/assets/js/71.f82c5f63.js"><link rel="prefetch" href="/keith-book/assets/js/72.bc8c9c4e.js"><link rel="prefetch" href="/keith-book/assets/js/73.0705a1c5.js"><link rel="prefetch" href="/keith-book/assets/js/74.5f096bb0.js"><link rel="prefetch" href="/keith-book/assets/js/75.3f8747a5.js"><link rel="prefetch" href="/keith-book/assets/js/76.651eb39a.js"><link rel="prefetch" href="/keith-book/assets/js/77.f999879e.js"><link rel="prefetch" href="/keith-book/assets/js/78.61f7757f.js"><link rel="prefetch" href="/keith-book/assets/js/79.8bd2dd06.js"><link rel="prefetch" href="/keith-book/assets/js/8.d352d476.js"><link rel="prefetch" href="/keith-book/assets/js/80.b123974d.js"><link rel="prefetch" href="/keith-book/assets/js/81.2009dcf1.js"><link rel="prefetch" href="/keith-book/assets/js/82.29cd7333.js"><link rel="prefetch" href="/keith-book/assets/js/83.936db179.js"><link rel="prefetch" href="/keith-book/assets/js/84.bc885c59.js"><link rel="prefetch" href="/keith-book/assets/js/85.d4e8c66d.js"><link rel="prefetch" href="/keith-book/assets/js/86.7cc46a2b.js"><link rel="prefetch" href="/keith-book/assets/js/87.2c8ce44d.js"><link rel="prefetch" href="/keith-book/assets/js/88.bb2c361f.js"><link rel="prefetch" href="/keith-book/assets/js/89.9a1ee5e4.js"><link rel="prefetch" href="/keith-book/assets/js/9.29357314.js"><link rel="prefetch" href="/keith-book/assets/js/90.aa69ffbe.js"><link rel="prefetch" href="/keith-book/assets/js/91.a8944021.js"><link rel="prefetch" href="/keith-book/assets/js/92.cd8a456d.js"><link rel="prefetch" href="/keith-book/assets/js/93.0b16e3c6.js"><link rel="prefetch" href="/keith-book/assets/js/94.d8822045.js"><link rel="prefetch" href="/keith-book/assets/js/95.fa963ca4.js"><link rel="prefetch" href="/keith-book/assets/js/96.c4728133.js"><link rel="prefetch" href="/keith-book/assets/js/97.f29d3516.js"><link rel="prefetch" href="/keith-book/assets/js/98.64cb768c.js"><link rel="prefetch" href="/keith-book/assets/js/99.7f8d1f38.js">
    <link rel="stylesheet" href="/keith-book/assets/css/0.styles.86c07c9d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/keith-book/" class="home-link router-link-active"><img src="/keith-book/favicon.ico" alt="鸿鹄笔记" class="logo"> <span class="site-name can-hide">鸿鹄笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/keith-book/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/keith-book/Java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/keith-book/Spring/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/keith-book/数据存储/" class="nav-link">
  数据存储
</a></div><div class="nav-item"><a href="/keith-book/设计模式/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/keith-book/数据结构/" class="nav-link">
  数据结构
</a></div><div class="nav-item"><a href="/keith-book/服务器/" class="nav-link">
  服务器
</a></div><div class="nav-item"><a href="/keith-book/前端/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/keith-book/拓展/" class="nav-link">
  拓展
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/keith-book/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/keith-book/Java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/keith-book/Spring/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/keith-book/数据存储/" class="nav-link">
  数据存储
</a></div><div class="nav-item"><a href="/keith-book/设计模式/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/keith-book/数据结构/" class="nav-link">
  数据结构
</a></div><div class="nav-item"><a href="/keith-book/服务器/" class="nav-link">
  服务器
</a></div><div class="nav-item"><a href="/keith-book/前端/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/keith-book/拓展/" class="nav-link">
  拓展
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/keith-book/数据存储/mysql/" class="sidebar-heading clickable open"><span>mysql</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/keith-book/数据存储/mysql/mysql基础.html" class="sidebar-link">mysql 基础</a></li><li><a href="/keith-book/数据存储/mysql/mysql事务.html" class="sidebar-link">mysql 事务</a></li><li><a href="/keith-book/数据存储/mysql/mysql索引.html" class="sidebar-link">mysql 索引</a></li><li><a href="/keith-book/数据存储/mysql/mysql锁.html" class="sidebar-link">mysql 锁</a></li><li><a href="/keith-book/数据存储/mysql/mysql主从复制.html" class="active sidebar-link">mysql 主从复制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/keith-book/数据存储/mysql/mysql主从复制.html#binlog的格式" class="sidebar-link">binlog的格式</a></li><li class="sidebar-sub-header"><a href="/keith-book/数据存储/mysql/mysql主从复制.html#复制原理" class="sidebar-link">复制原理</a></li><li class="sidebar-sub-header"><a href="/keith-book/数据存储/mysql/mysql主从复制.html#配置-基于mysql-8-x" class="sidebar-link">配置(基于mysql 8.x)</a></li><li class="sidebar-sub-header"><a href="/keith-book/数据存储/mysql/mysql主从复制.html#常用命令" class="sidebar-link">常用命令</a></li></ul></li><li><a href="/keith-book/数据存储/mysql/mysql调优.html" class="sidebar-link">mysql 调优</a></li><li><a href="/keith-book/数据存储/mysql/mysql分区表.html" class="sidebar-link">mysql分区表</a></li><li><a href="/keith-book/数据存储/mysql/mysql服务器参数配置.html" class="sidebar-link">mysql 服务器参数设置</a></li><li><a href="/keith-book/数据存储/mysql/mysql分库分表.html" class="sidebar-link">mysql 分库分表</a></li><li><a href="/keith-book/数据存储/mysql/SQL执行底层原理.html" class="sidebar-link">SQL 执行底层原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/keith-book/数据存储/redis/" class="sidebar-heading clickable"><span>redis</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/keith-book/数据存储/redis/redis基础.html" class="sidebar-link">redis基础</a></li><li><a href="/keith-book/数据存储/redis/redis命令速查.html" class="sidebar-link">redis命令速查</a></li><li><a href="/keith-book/数据存储/redis/redis常见缓存问题.html" class="sidebar-link">redis常见缓存问题</a></li><li><a href="/keith-book/数据存储/redis/redis配置.html" class="sidebar-link">redis配置文件</a></li><li><a href="/keith-book/数据存储/redis/redis线程模型.html" class="sidebar-link">redis线程模型</a></li><li><a href="/keith-book/数据存储/redis/redis事务.html" class="sidebar-link">redis事务</a></li><li><a href="/keith-book/数据存储/redis/redis过期策略.html" class="sidebar-link">redis过期策略</a></li><li><a href="/keith-book/数据存储/redis/redis分布式锁.html" class="sidebar-link">redis分布式锁</a></li><li><a href="/keith-book/数据存储/redis/redis集群.html" class="sidebar-link">redis集群</a></li><li><a href="/keith-book/数据存储/redis/redis主从复制.html" class="sidebar-link">redis主从复制</a></li><li><a href="/keith-book/数据存储/redis/redis持久化.html" class="sidebar-link">redis持久化</a></li><li><a href="/keith-book/数据存储/redis/redis漏斗算法.html" class="sidebar-link">redis漏斗算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/keith-book/数据存储/mq/" class="sidebar-heading clickable"><span>mq</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/keith-book/数据存储/mq/RabbitMQ基础.html" class="sidebar-link">RabbitMQ基础</a></li><li><a href="/keith-book/数据存储/mq/RabbitMQ高级.html" class="sidebar-link">RabbitMQ高级</a></li><li><a href="/keith-book/数据存储/mq/RabbitMQ应用.html" class="sidebar-link">RabbitMQ应用</a></li></ul></section></li><li><a href="/keith-book/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/elasticsearch/" class="sidebar-link">elasticsearch</a></li><li><a href="/keith-book/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/mongodb/" class="sidebar-link">mongodb</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql-主从复制"><a href="#mysql-主从复制" class="header-anchor">#</a> mysql 主从复制</h1> <h2 id="binlog的格式"><a href="#binlog的格式" class="header-anchor">#</a> binlog的格式</h2> <p>binlog_format=STATEMENT（默认）：记录写操作SQL，会有以下问题</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 如果有时间函数，那么主从复制的时间会不一致</span>
<span class="token keyword">update</span> xxx <span class="token keyword">set</span> <span class="token keyword">time</span> <span class="token operator">=</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'zhangsan'</span>
</code></pre></div><p>binlog_format=ROW：记录一整行记录，会完全拷贝原记录，效率低</p> <p>binlog_format=MIXED：判断写操作有没有函数，有则用STATEMENT，没有则用ROW</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 如果出现系统变量，也会出现主从复制不一致</span>
@<span class="token variable">@host</span> name
</code></pre></div><h2 id="复制原理"><a href="#复制原理" class="header-anchor">#</a> 复制原理</h2> <ol><li>master将改变记录到二进制日志(binary log)，这个记录过程叫二进制日志事件(binary log events)。</li> <li>slave将master的binary log events拷贝到它的中继日志(relay log)。</li> <li>slave重做中继日志中的事件，将改变应用到自己的数据库中，Mysql复制是异步且串行化的。
<img src="https://img-blog.csdnimg.cn/20200203173115696.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjEwMzAyNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li></ol> <h2 id="配置-基于mysql-8-x"><a href="#配置-基于mysql-8-x" class="header-anchor">#</a> 配置(基于mysql 8.x)</h2> <h3 id="master配置文件修改"><a href="#master配置文件修改" class="header-anchor">#</a> master配置文件修改</h3> <div class="language-properties extra-class"><pre class="language-properties"><code>[mysqld]
<span class="token comment"># 设置主机Id</span>
<span class="token attr-name">server-id</span><span class="token punctuation">=</span><span class="token attr-value">1</span>
<span class="token comment"># 启用二进制日志</span>
<span class="token attr-name">log-bin</span><span class="token punctuation">=</span><span class="token attr-value">E:\\Software\\mysql-8.0.19\\data\\logbin</span>
</code></pre></div><h3 id="slave配置文件修改"><a href="#slave配置文件修改" class="header-anchor">#</a> slave配置文件修改</h3> <div class="language-properties extra-class"><pre class="language-properties"><code>[mysqld]
<span class="token comment"># 设置从机Id</span>
<span class="token attr-name">server-id</span><span class="token punctuation">=</span><span class="token attr-value">2</span>
<span class="token comment"># 启用二进制日志</span>
<span class="token attr-name">log-bin</span><span class="token punctuation">=</span><span class="token attr-value">/var/run/mysqld/logbin</span>
</code></pre></div><h3 id="具体操作"><a href="#具体操作" class="header-anchor">#</a> 具体操作</h3> <blockquote><p>主机IP：192.168.1.104
从机IP：192.168.25.103</p></blockquote> <ol><li>主节点创建用户并授权</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'repl'</span><span class="token variable">@'192.168.1.104'</span> identified <span class="token keyword">with</span> mysql_native_password <span class="token keyword">by</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">replication</span> slave <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'repl'</span><span class="token variable">@'192.168.1.104'</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>查询主节点状态</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 刷新</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
<span class="token comment">-- 查询主节点状态</span>
<span class="token keyword">show</span> master <span class="token keyword">status</span><span class="token punctuation">;</span>
</code></pre></div><p>参数解释：</p> <ul><li>File：二进制日志文件</li> <li>Position：开始抄数据的位置</li> <li>Binlog_Do_DB：需要复制的数据库，空表示都要复制</li> <li>Binlog_Ignore_DB：忽略的数据库，空表示没有
<img src="https://img-blog.csdnimg.cn/20200201111401768.png" alt="在这里插入图片描述"></li></ul> <ol start="3"><li>在从节点上设置主节点参数</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code>change master <span class="token keyword">to</span> master_host <span class="token operator">=</span> <span class="token string">'192.168.1.104'</span><span class="token punctuation">,</span>
master_user <span class="token operator">=</span> <span class="token string">'repl'</span><span class="token punctuation">,</span>
master_password <span class="token operator">=</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>
master_log_file <span class="token operator">=</span> <span class="token string">'binlog.000017'</span><span class="token punctuation">,</span> master_log_pos <span class="token operator">=</span> <span class="token number">5934</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>开启主从同步</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">start</span> slave<span class="token punctuation">;</span>
</code></pre></div><ol start="5"><li>查看主从同步状态</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> slave <span class="token keyword">status</span><span class="token punctuation">;</span>
</code></pre></div><ol start="6"><li>测试</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> dbtest<span class="token punctuation">;</span>
<span class="token keyword">use</span> dbtest<span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> dog<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> dog<span class="token punctuation">(</span>
	id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    dog_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dog <span class="token punctuation">(</span>dog_name<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'旺财'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dog <span class="token punctuation">(</span>dog_name<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'大白'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dog <span class="token punctuation">(</span>dog_name<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'汪汪'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>主机从机同步，测试成功。</p> <h2 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 获取binlog文件列表</span>
<span class="token keyword">show</span> <span class="token keyword">binary</span> logs<span class="token punctuation">;</span>
<span class="token comment">-- 查看指定binlog文件的内容</span>
<span class="token keyword">show</span> binlog events <span class="token operator">in</span> <span class="token string">'binlog.000017'</span><span class="token punctuation">;</span>
<span class="token comment">-- 停止同步</span>
stop slave<span class="token punctuation">;</span>
<span class="token comment">-- 查询用户</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token comment">-- 删除用户</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>mysql<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>Host<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'192.168.25.103'</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span><span class="token punctuation">`</span><span class="token keyword">User</span><span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'rep1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 修改用户密码</span>
<span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">'repl'</span><span class="token variable">@'192.168.1.104'</span> identified <span class="token keyword">with</span> mysql_native_password <span class="token keyword">by</span> <span class="token string">'654321'</span><span class="token punctuation">;</span>
<span class="token comment">-- 授予用户权限</span>
<span class="token keyword">grant</span> <span class="token keyword">replication</span> slave <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'repl'</span><span class="token variable">@'192.168.1.104'</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/21/2021, 11:41:55 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/keith-book/数据存储/mysql/mysql锁.html" class="prev">
        mysql 锁
      </a></span> <span class="next"><a href="/keith-book/数据存储/mysql/mysql调优.html">
        mysql 调优
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/keith-book/assets/js/app.7ae60ab7.js" defer></script><script src="/keith-book/assets/js/2.044773f5.js" defer></script><script src="/keith-book/assets/js/49.a0d6928f.js" defer></script>
  </body>
</html>
